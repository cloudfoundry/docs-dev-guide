<!doctype html>
<html>
  <head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine or request Chrome Frame -->
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title>Grails - Service Bindings</title>

    <link href="/stylesheets/master.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/style.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="/javascripts/all.js" type="text/javascript"></script>
    <link href='/images/favicon.ico' rel='shortcut icon'>
    <script type="text/javascript">
      $(document).ready(function(){
        $('a#search').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 20px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2').css("padding","11px 10px 8px");
          $('#search-on').show();
          $('#search-off').hide();
        });
        $('.cancel-x').click(function () {
          $('#organization_bar .navbar .nav>li a').css("padding","11px 63px 8px");
          $('#organization_bar .navbar .nav>li a#docs').css("padding","14px 20px");
          $('#organization_bar .navbar .nav>li a#search2, #organization_bar .navbar .nav>li a#search').css("padding","16px 20px 15px");
          $('#organization_bar .navbar .nav>li a#getinvolved').css("padding","11px 92px 8px");
          $('#organization_bar .navbar .nav>li#docs-off .docs-list-list a').css("padding","0");
          $('#search-on').hide();
          $('#search-off').show();
        });f
        $(".togglebutton").click(function () {
        var divname= this.value;
          $("#"+divname).show("slow").siblings().hide("slow");
        });
      });
    </script>

    <!--[if lt IE 9]>
    <style>
        #content .container-full {background:  #ebf0fa;}
        .call-to-contribute-box, .column-left, .column-middle, .column-right {background:#e3e8f2}
        #footer {background:#000;}
    </style>
    <![endif]-->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-22181585-1']);
      _gaq.push(['_setDomainName', 'cloudfoundry.com']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>

  <body class="docs docs_services docs_services_system-services docs_services_system-services_grails-service-bindings">
    <img id="bg" src="/images/bg-plain-x.jpg">
    <div id='non_footer'>
      <div id='header'>
        <div class='container_wide'>
          <ul class='actions'>
            <li class='last'>
              <a href="http://www.cloudfoundry.com/contact">Contact Us</a>
            </li>
            <li>
              <a class='register_link' href='http://login.run.pivotal.io/login'>My Account</a>            
            </li>
          </ul>
        </div>
      </div>
      <div id='content'>
        <div class='logo-main'>
          <div class='logo'>
            <a href='http://www.cloudfoundry.com'>
            <img src='/images/logo-cloudfoundry.png'>
            </a>
            <a href='http://www.gopivotal.com' target="_blank">
            <img id="pivotal-logo" src='/images/logo-pivotal.png'>
            </a>
          </div>
          <div class='cta'>
            <a href='https://console.run.pivotal.io'>
            <img src='/images/signup_freetrial.png'>
            </a>
          </div>
        </div><!-- End of logo-main-->
        <div class='container-full'>
          <div id='organization_bar'>
            <div class='navbar'>
              <ul class='nav'>
                <li>
                <a href='http://www.cloudfoundry.com/use' id='use'>Using Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/run' id='run'>Running Cloud Foundry</a>
                </li>
                <li>
                <a href='http://www.cloudfoundry.com/getinvolved' id='getinvolved'>Get Involved</a>
                </li>
                <li id='docs-off'>
                  <a href='/' id='docs'>
                    <div id='icon-docs'></div>
                  </a>
                  <div id='docs-list'>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/using/app-arch/'>Using Cloud Foundry</a>
                      <br>
                      <a href="/docs/using/app-arch/">Application Architecture Considerations</a>
                      <br>
                      <a href='/docs/using/deploying-apps/'>Deploying Apps</a>
                      <br>
                      <a href='/docs/using/managing-apps/'>Managing Apps</a>
                      <br>
                      <a href='/docs/using/services.html'>Using Services</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/using/">See all</a>
                    </div><!-- End of 1st column docs-list-list-->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/running/'>Running Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/architecture/'>Architecture</a>
                      <br>
                      <a href='/docs/running/bosh/'>BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf/'>Deploying with BOSH</a>
                      <br>
                      <a href='/docs/running/deploying-cf-with-chef/'>Deploying with Chef</a>
                      <br>
                      <a href='/docs/running/micro_cloud_foundry/'>Micro Cloud Foundry</a>
                      <br>
                      <a href='/docs/running/managing-cf/index.html'>Managing Cloud Foundry</a>
                      <br>
                      <a class="docs-list-see-all" href="/docs/running/">See all</a>
                    </div><!-- End of column 2 docs-list-list -->
                    <div class="hr-vertical"></div>
                    <div class="docs-list-list">
                      <a class="docs-list-th" href='/docs/reference/'>Reference</a>
                      <br>
                      <a href='/docs/reference/cc-api.html'>Cloud Foundry REST API</a>
                      <br>
                      <a class="docs-list-th" href='/docs/dotcom/'>CloudFoundry.com</a>
                      <br>
                      <a href='/docs/dotcom/integration/'>Technical Integration</a>
                      <br>
                      <a class="docs-list-th" href='/docs/community/'>Community</a>
                    </div><!-- End of column 3 docs-list-list -->
                  </div><!-- End of docs-list -->
                </li>
                <li id='search-off'>
                  <a id='search'>
                    <div class='icon-search'></div>
                  </a>
                </li>
                <li id='search-on'>
                  <a id='search2'>
                    <form action='http://www.cloudfoundry.com/search' class='search-form' method='get' onsubmit='return submitQuery()'>
                      <input autocomplete='off' class='search-input' id='search-query' name='q' onfocus="this.placeholder = ''" placeholder='' type='search' value=''>
                    </form>
                    <div class="cancel-x"></div>
                  </a>
                </li>
              </ul>
            </div><!-- End of navbar -->
          </div><!-- End of organization_bar -->
          <div class='content_inner'>
            <a class="forkme" href="http://github.com/cloudfoundry/cf-docs" target="_blank">
              <img alt="Fork me on GitHub" src="/images/ribbon_forkme.png">
            </a>
            <form action='http://www.cloudfoundry.com/search' class='search-docs-form' method='get' onsubmit='return submitQuery()'>
              <input autocomplete='off' class='search-docs-input' id='search-query' name='q' onfocus="this.placeholder = 'more:docs '" placeholder='' type='search-docs' value='more:docs '>
            </form>
            <br clear="left">
            
              <div class="breadcrumbs">
                <ul>
                  <li>
                    <a href="/">Home</a>
                  </li>
                  <li class=""><a href="/docs/">Deploy Applications</a></li> <li class=""><a href="/docs/services/">Using Services</a></li> <li class=""><a href="/docs/services/system-services/">Create and Bind System Services</a></li> <li class="active"><span>Grails - Service Bindings</span></li>
                </ul>
              </div>
              <br clear="left">

			

              <div class="quick-links"><ul>
<li><a href="#auto">Auto-Configuration</a></li>
<li><a href="#manual">Manual Configuration</a></li>
</ul>
</div>

              <h1>Grails - Service Bindings</h1>

            
            <p>Cloud Foundry provides extensive support for connecting a Grails application to services such as MySQL, Postgres, MongoDB, Redis, and RabbitMQ. In many cases, a Grails application running on Cloud Foundry can automatically detect and configure connections to services. For more advanced cases, you can control service connection parameters yourself. </p>

<h2><a id="auto"></a>Auto-Configuration</h2>

<p>Grails provides plugins for accessing SQL (using <a href="http://grails.org/plugin/hibernate">Hibernate</a>), <a href="http://www.grails.org/plugin/mongodb">MongoDB</a>, and <a href="http://grails.org/plugin/redis">Redis</a> services. If you install any of these plugins and configure them in your <code>Config.groovy</code> or <code>DataSource.groovy</code> file, the Cloud Foundry Grails plugin will re-configure the plugins when the app starts to provide the connection information to the plugins. </p>

<p>To enable auto-configuration of service connections, add the <code>cloudfoundry-runtime</code> library to the <code>dependencies</code> section in your <code>BuildConfig.groovy</code> file, and add the <code>cloud-foundry</code> plugin to the <code>plugins</code> section. You will also need the Spring Framework Milestone repository in the <code>repositories</code> section. <strong>For Cloud Foundry v2 support, the version of <code>cloudfoundry-runtime</code> must be at least <code>0.8.4</code></strong>:</p>
<pre class="highlight groovy">  <span class="n">repositories</span> <span class="o">{</span>
    <span class="n">grailsHome</span><span class="o">()</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
    <span class="n">grailsCentral</span><span class="o">()</span>
    <span class="n">mavenRepo</span> <span class="s2">&quot;http://maven.springframework.org/milestone/&quot;</span>
  <span class="o">}</span>

  <span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s2">&quot;org.cloudfoundry:cloudfoundry-runtime:0.8.4&quot;</span>
  <span class="o">}</span>

  <span class="n">plugins</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s1">':cloud-foundry:1.2.3'</span>
  <span class="o">}</span>
</pre>
<p>If you were using all three types of services, your configuration might look like this: </p>
<pre class="highlight groovy"><span class="n">environments</span> <span class="o">{</span>
  <span class="n">production</span> <span class="o">{</span>
    <span class="n">dataSource</span> <span class="o">{</span>
      <span class="n">url</span> <span class="o">=</span> <span class="s1">'jdbc:mysql://localhost/db?useUnicode=true&amp;characterEncoding=utf8'</span>
      <span class="n">dialect</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">hibernate</span><span class="o">.</span><span class="na">dialect</span><span class="o">.</span><span class="na">MySQLInnoDBDialect</span>
      <span class="n">driverClassName</span> <span class="o">=</span> <span class="s1">'com.mysql.jdbc.Driver'</span>
      <span class="n">username</span> <span class="o">=</span> <span class="s1">'user'</span>
      <span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;password&quot;</span>
    <span class="o">}</span>
    <span class="n">grails</span> <span class="o">{</span>
      <span class="n">mongo</span> <span class="o">{</span>
        <span class="n">host</span> <span class="o">=</span> <span class="s1">'localhost'</span>
        <span class="n">port</span> <span class="o">=</span> <span class="mi">27107</span>
        <span class="n">databaseName</span> <span class="o">=</span> <span class="s2">&quot;foo&quot;</span>
        <span class="n">username</span> <span class="o">=</span> <span class="s1">'user'</span>
        <span class="n">password</span> <span class="o">=</span> <span class="s1">'password'</span>
      <span class="o">}</span>
      <span class="n">redis</span> <span class="o">{</span>
        <span class="n">host</span> <span class="o">=</span> <span class="s1">'localhost'</span>
        <span class="n">port</span> <span class="o">=</span> <span class="mi">6379</span>
        <span class="n">password</span> <span class="o">=</span> <span class="s1">'password'</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="mi">2000</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
<p>The <code>url</code>, <code>host</code>, <code>port</code>, <code>databaseName</code>, <code>username</code>, and <code>password</code> fields in this configuration will be overriden by the Cloud Foundry Grails plugin if it detects that the application is running in a Cloud Foundry environment. If you want to test the application locally against your own services, you can put real values in these fields. If the application will only be run against Cloud Foundry services, you can put placeholder values as shown here, but the fields must exist in the configuration. </p>

<h2><a id="manual"></a>Manual Configuration</h2>

<p>If you do not want to use the Cloud Foundry Grails plugin, you can choose to configure the Cloud Foundry service connections manually. </p>

<p>The best way to do the manual configuration is to use the <code>cloudfoundry-runtime</code> library to get the details of the Cloud Foundry environment the application is running in. To use this library, add it to the <code>dependencies</code> section in your <code>BuildConfig.groovy</code> file. You will also need the Spring Framework Milestone repository in the <code>repositories</code> section. <strong>For Cloud Foundry v2 support, the version of this library must be at least <code>0.8.4</code></strong>:</p>
<pre class="highlight groovy">  <span class="n">repositories</span> <span class="o">{</span>
    <span class="n">grailsHome</span><span class="o">()</span>
    <span class="n">mavenCentral</span><span class="o">()</span>
    <span class="n">grailsCentral</span><span class="o">()</span>
    <span class="n">mavenRepo</span> <span class="s2">&quot;http://maven.springframework.org/milestone/&quot;</span>
  <span class="o">}</span>

  <span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s2">&quot;org.cloudfoundry:cloudfoundry-runtime:0.8.4&quot;</span>
  <span class="o">}</span>
</pre>
<p>Then you can use the <code>cloudfoundry-runtime</code> API in your <code>DataSources.groovy</code> file to set the connection parameters. If you were using all three types of database services as in the auto-configuration example, and the services were named &ldquo;myapp-mysql&rdquo;, &ldquo;myapp-mongodb&rdquo;, and &ldquo;myapp-redis&rdquo;, your <code>DataSources.groovy</code> file might look like the one below. </p>
<pre class="highlight groovy"><span class="kn">import</span> <span class="nn">org.cloudfoundry.runtime.env.CloudEnvironment</span>
<span class="kn">import</span> <span class="nn">org.cloudfoundry.runtime.env.RdbmsServiceInfo</span>
<span class="kn">import</span> <span class="nn">org.cloudfoundry.runtime.env.RedisServiceInfo</span>
<span class="kn">import</span> <span class="nn">org.cloudfoundry.runtime.env.MongoServiceInfo</span>

<span class="kt">def</span> <span class="n">cloudEnv</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CloudEnvironment</span><span class="o">()</span>

<span class="n">environments</span> <span class="o">{</span>
  <span class="n">production</span> <span class="o">{</span>
    <span class="n">dataSource</span> <span class="o">{</span>
      <span class="n">pooled</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="n">dbCreate</span> <span class="o">=</span> <span class="s1">'update'</span>
      <span class="n">driverClassName</span> <span class="o">=</span> <span class="s1">'com.mysql.jdbc.Driver'</span>

      <span class="k">if</span> <span class="o">(</span><span class="n">cloudEnv</span><span class="o">.</span><span class="na">isCloudFoundry</span><span class="o">())</span> <span class="o">{</span>
        <span class="kt">def</span> <span class="n">dbInfo</span> <span class="o">=</span> <span class="n">cloudEnv</span><span class="o">.</span><span class="na">getServiceInfo</span><span class="o">(</span><span class="s1">'myapp-mysql'</span><span class="o">,</span> <span class="n">RdbmsServiceInfo</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="n">dbInfo</span><span class="o">.</span><span class="na">url</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">dbInfo</span><span class="o">.</span><span class="na">userName</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">dbInfo</span><span class="o">.</span><span class="na">password</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">'jdbc:mysql://localhost:5432/myapp'</span>
        <span class="n">username</span> <span class="o">=</span> <span class="s1">'sa'</span>
        <span class="n">password</span> <span class="o">=</span> <span class="s1">''</span>
      <span class="o">}</span>
    <span class="o">}</span>

    <span class="n">grails</span> <span class="o">{</span>
      <span class="n">mongo</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">cloudEnv</span><span class="o">.</span><span class="na">isCloudFoundry</span><span class="o">())</span> <span class="o">{</span>
          <span class="kt">def</span> <span class="n">mongoInfo</span> <span class="o">=</span> <span class="n">cloudEnv</span><span class="o">.</span><span class="na">getServiceInfo</span><span class="o">(</span><span class="s1">'myapp-mongodb'</span><span class="o">,</span> <span class="n">MongoServiceInfo</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
          <span class="n">host</span> <span class="o">=</span> <span class="n">mongoInfo</span><span class="o">.</span><span class="na">host</span>
          <span class="n">port</span> <span class="o">=</span> <span class="n">mongoInfo</span><span class="o">.</span><span class="na">port</span>
          <span class="n">databaseName</span> <span class="o">=</span> <span class="n">mongoInfo</span><span class="o">.</span><span class="na">database</span>
          <span class="n">username</span> <span class="o">=</span> <span class="n">mongoInfo</span><span class="o">.</span><span class="na">userName</span>
          <span class="n">password</span> <span class="o">=</span> <span class="n">mongoInfo</span><span class="o">.</span><span class="na">password</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="n">host</span> <span class="o">=</span> <span class="s1">'localhost'</span>
          <span class="n">port</span> <span class="o">=</span> <span class="mi">27107</span>
          <span class="n">databaseName</span> <span class="o">=</span> <span class="s1">'foo'</span>
          <span class="n">username</span> <span class="o">=</span> <span class="s1">'user'</span>
          <span class="n">password</span> <span class="o">=</span> <span class="s1">'password'</span>
        <span class="o">}</span>
      <span class="o">}</span>
      <span class="n">redis</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">cloudEnv</span><span class="o">.</span><span class="na">isCloudFoundry</span><span class="o">())</span> <span class="o">{</span>
          <span class="kt">def</span> <span class="n">redisInfo</span> <span class="o">=</span> <span class="n">cloudEnv</span><span class="o">.</span><span class="na">getServiceInfo</span><span class="o">(</span><span class="s1">'myapp-redis'</span><span class="o">,</span> <span class="n">RedisServiceInfo</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
          <span class="n">host</span> <span class="o">=</span> <span class="n">redisInfo</span><span class="o">.</span><span class="na">host</span>
          <span class="n">port</span> <span class="o">=</span> <span class="n">redisInfo</span><span class="o">.</span><span class="na">port</span>
          <span class="n">password</span> <span class="o">=</span> <span class="n">redisInfo</span><span class="o">.</span><span class="na">password</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
          <span class="n">host</span> <span class="o">=</span> <span class="s1">'localhost'</span>
          <span class="n">port</span> <span class="o">=</span> <span class="mi">6379</span>
          <span class="n">password</span> <span class="o">=</span> <span class="s1">'password'</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre>
          </div><!-- End of content_inner -->
        </div><!-- End of container-full -->
      </div><!-- End of content -->
    </div><!-- End of non_footer -->
    <div id='footer'>
      <div id='container-footer'>
        <div class='bg_social'>
          <ul class='social'>
            <li>
            <a href='http://twitter.com/cloudfoundry' target='_blank'>
            <img alt='Twitter' src='/images/twitter_large.png'>
            </a>
            </li>
            <li>
            <a href='https://plus.google.com/114245065906861739918/posts' target='_blank'>
            <img alt='Google+' src='/images/g+_large.png'>
            </a>
            </li>
            <li>
            <a href='http://facebook.com/cloudfoundry' target='_blank'>
            <img alt='Facebook' src='/images/facebook_large.png'>
            </a>
            </li>
            <li>
            <a href='http://youtube.com/cloudfoundry' target='_blank'>
            <img alt='Youtube' src='/images/youtube_large.png'>
            </a>
            </li>
          </ul>
        </div><!-- End of bg_social -->
        <ul class='links'>
          <li>
          <a href='http://www.cloudfoundry.com/about'>About</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://blog.cloudfoundry.com/'>Blog</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/partners'>Partners</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://docs.cloudfoundry.com'>Docs</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/faq'>FAQ</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/getinvolved'>Get Involved</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://status.cloudfoundry.com/'>Status</a>
          </li>
          <li class='disc'>•</li>
          <li>
          <a href='http://www.cloudfoundry.com/support'>Support</a>
          </li>
        </ul>
        <div class='copyright'>
          <div class='hr-horizontal-dark'></div>
          <br>
          <p>
            &copy;
            <script>
              //<![CDATA[
                var d = new Date();
                document.write(d.getFullYear());
              //]]>
            </script>
            GoPivotal, Inc. All rights reserved.
            <a href='http://www.cloudfoundry.com/terms'>Terms</a>
            <a href='http://www.gopivotal.com/privacy-policy' target='_blank'>Privacy</a>
          </p>
        </div><!-- End of copyright -->
      </div><!-- End of container-footer -->
    </div><!-- End of footer -->
    <script type="text/javascript">
      (function() {
        var didInit = false;
        function initMunchkin() {
          if(didInit === false) {
            didInit = true;
            Munchkin.init('625-IUJ-009');
          }
        }
        var s = document.createElement('script');
        s.type = 'text/javascript';
        s.async = true;
        s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
        s.onreadystatechange = function() {
          if (this.readyState == 'complete' || this.readyState == 'loaded') {
            initMunchkin();
          }
        };
        s.onload = initMunchkin;
        document.getElementsByTagName('head')[0].appendChild(s);
      })();
    </script>
  </body>
</html>
